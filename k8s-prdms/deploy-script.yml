---
- name: deploy product details microservice application
  hosts: windows
  gather_facts: no
  vars:
    workdir: D:\applications\productdetailsms\k8s-prdms
    src_file: /home/samra/power-tiller-app/k8s-prdms/deploy-script.yml
    dest_file: D:\applications\productdetailsms\k8s-prdms\deploy-script.yml
  tasks:
    
    # in real time do check cluster is running or not but here for time saving not executing below two tasks 

     #  - name: Ensure minikube is running
     # win_shell: minikube status 
     # register: minikube_status
     # ignore_errors: yes

     #- name: start minikube
     # win_shell: minikube start
     # when: minikube_status.rc !=0

    - name: deploy statefulset 
      win_shell: kubectl apply -f {{ workdir }}/StatefulsetMysql.yml

    - name: start mysql service 
      win_shell: kubectl apply -f {{ workdir }}/MysqlService.yml

    - name: deploy application
      win_shell: kubectl apply -f {{ workdir }}/Deployment.yml 
    
    - name: create service 
      win_shell: kubectl apply -f {{ workdir }}/AppService.yml
    
    - name: Copy file to destination
      win_copy:
        src: "{{ src_file }}"
        dest: "{{ dest_file }}"



      ## this below part no need to mention it will throw error if we run like this

      # - name: start statefulset service
      #   win_shell: minikube service mysql   

      #  - name: start application loadbalancer service
      #  win_shell: minikube service inquiry-app
...
